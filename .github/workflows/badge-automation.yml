name: Registrar Badges e Criar Certificados

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: write
  pull-requests: write

jobs:
  process-badge:
    runs-on: ubuntu-latest

    steps:

      - name: üì• Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: üß∞ Instalar Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: üìù Criar diret√≥rios necess√°rios
        run: |
          mkdir -p badges certificados templates

      - name: üöÄ Executar automa√ß√£o
        env:
          PR_USER: ${{ github.actor }}
          BADGE_TYPE: ${{ env.BADGE_TYPE }}
          REPO_URL: ${{ github.event.repository.html_url }}
        run: node process.js
        
      - name: üß† Identificar tipo de badge pelo t√≠tulo do PR
        run: |
          TITLE="${{ github.event.pull_request.title }}"
          echo "T√≠tulo detectado: $TITLE"

          if [[ "$TITLE" == *"[mestre]"* ]]; then
            echo "BADGE_TYPE=mestre" >> $GITHUB_ENV
          elif [[ "$TITLE" == *"[apoia]"* ]]; then
            echo "BADGE_TYPE=apoia" >> $GITHUB_ENV
          else
            echo "‚ùå ERRO: O PR precisa conter [mestre] ou [apoia] no t√≠tulo."
            exit 1
          fi

      - name: üöÄ Executar automa√ß√£o
        env:
          PR_USER: ${{ github.actor }}
          BADGE_TYPE: ${{ env.BADGE_TYPE }}
          REPO_URL: ${{ github.event.pull_request.head.repo.html_url }}
        run: node process.js

      